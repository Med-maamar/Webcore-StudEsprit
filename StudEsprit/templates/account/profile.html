{% extends 'base.html' %}
{% block content %}
<div class="max-w-3xl mx-auto space-y-8">
  <div class="bg-white rounded-3xl border border-gray-200 shadow p-6">
    <h2 class="text-2xl font-semibold text-esprit-red mb-6">Profil</h2>
    <form method="post" action="/account/profile/update" class="space-y-5">
      {% csrf_token %}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-esprit-gray mb-1">Adresse e-mail</label>
          <input value="{{ user.email }}" disabled class="w-full px-4 py-2 rounded-xl border border-gray-300 bg-gray-100" />
        </div>
        <div>
          <label class="block text-sm font-medium text-esprit-gray mb-1">Nom d'utilisateur</label>
          <input name="username" value="{{ user.username }}" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:border-esprit-red focus:ring-esprit-red" />
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-esprit-gray mb-1">Avatar (URL)</label>
        <div class="flex items-center gap-4">
          <img src="{{ user.avatar_url|default:'#' }}" alt="avatar" class="w-16 h-16 rounded-full object-cover border border-gray-300" onerror="this.style.display='none'"/>
          <input name="avatar_url" placeholder="Coller un lien d'image" value="{{ user.avatar_url }}" class="flex-1 px-4 py-2 rounded-xl border border-gray-300 focus:border-esprit-red focus:ring-esprit-red" />
        </div>
      </div>
      <div>
        <button class="px-5 py-2 rounded-full bg-esprit-red text-white font-semibold hover:bg-[#a00d26]">Enregistrer</button>
      </div>
    </form>
    <form method="post" action="/account/profile/upload-avatar" enctype="multipart/form-data" class="mt-6 border-t border-gray-200 pt-4">
      {% csrf_token %}
      <p class="text-sm text-esprit-gray mb-2">Téléverser une nouvelle photo (PNG, JPG, WebP • 5 Mo max)</p>
      <div class="flex items-center gap-3">
        <input type="file" name="avatar_file" accept="image/png,image/jpeg,image/webp" class="block w-full text-sm" />
        <button class="px-4 py-2 rounded-full bg-esprit-red text-white font-semibold hover:bg-[#a00d26]">Téléverser</button>
      </div>
    </form>
  </div>

  <!-- Profil Carrière -->
  <div class="bg-white rounded-3xl border border-gray-200 shadow p-6">
    <h2 class="text-2xl font-semibold text-esprit-red mb-6">Profil Carrière</h2>
    <div id="profile-form-wrapper">
      {% include 'careers/partials/profile_form.html' %}
    </div>
    <div class="mt-6">
      <h3 class="text-lg font-semibold mb-2">Téléverser un CV (PDF)</h3>
      <form method="post" action="/account/profile/upload-cv" enctype="multipart/form-data" class="flex items-center gap-3">
        {% csrf_token %}
        <input type="file" name="cv_file" accept="application/pdf" class="block w-full text-sm" />
        <button class="px-4 py-2 rounded-full bg-esprit-red text-white font-semibold hover:bg-[#a00d26]">Téléverser & Analyser</button>
      </form>
      <p class="text-xs text-gray-500 mt-1">Votre CV sera stocké et lu (texte) pour enrichir compétences, langues, projets.</p>
      {% if profile.cv_url %}
      <div class="mt-3 flex items-center gap-3">
        <a href="{{ profile.cv_url }}" target="_blank" class="text-esprit-red underline">Voir le CV actuel</a>
        <form method="post" action="/account/profile/delete-cv">
          {% csrf_token %}
          <button class="px-3 py-1 rounded-full border border-gray-300 hover:bg-gray-50" type="submit">Supprimer</button>
        </form>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="bg-white rounded-3xl border border-gray-200 shadow p-6">
    <h2 class="text-2xl font-semibold text-esprit-red mb-6">Changer de mot de passe</h2>
    <form method="post" action="/account/change-password" class="space-y-4">
      {% csrf_token %}
      <div>
        <label class="block text-sm font-medium text-esprit-gray mb-1">Nouveau mot de passe</label>
        <input name="new_password" type="password" required class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:border-esprit-red focus:ring-esprit-red" />
      </div>
      <div>
        <label class="block text-sm font-medium text-esprit-gray mb-1">Confirmer</label>
        <input name="confirm_password" type="password" required class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:border-esprit-red focus:ring-esprit-red" />
      </div>
      <button class="px-5 py-2 rounded-full bg-esprit-red text-white font-semibold hover:bg-[#a00d26]" type="submit">Mettre à jour</button>
    </form>
  </div>
</div>
{% endblock %}
