{% extends 'base.html' %}
{% block content %}
  {% if student_empty %}
    <div class="max-w-3xl mx-auto">
      <div class="p-10 rounded-3xl border border-gray-200 bg-white text-center shadow">
        <h1 class="text-2xl font-semibold text-esprit-red mb-2">Bienvenue sur StudEsprit</h1>
        <p class="text-esprit-gray">Votre espace étudiant personnalisé sera bientôt disponible. En attendant, explorez les programmes et les services du campus.</p>
      </div>
    </div>
  {% else %}
    <div class="space-y-6">
      <!-- KPI Cards (Admins only) -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="p-5 bg-white rounded-2xl shadow border border-gray-200">
          <div class="text-sm text-esprit-gray uppercase">Total utilisateurs</div>
          <div class="text-3xl font-semibold text-esprit-red">{{ total_users }}</div>
        </div>
        <div class="p-5 bg-white rounded-2xl shadow border border-gray-200">
          <div class="text-sm text-esprit-gray uppercase">Nouveaux (7j)</div>
          <div class="text-3xl font-semibold text-esprit-red">{{ new_last_7 }}</div>
        </div>
        <div class="p-5 bg-white rounded-2xl shadow border border-gray-200">
          <div class="text-sm text-esprit-gray uppercase">Connexions (24h)</div>
          <div class="text-3xl font-semibold text-esprit-red">{{ logins_24h }}</div>
        </div>
        <div class="p-5 bg-white rounded-2xl shadow border border-gray-200">
          <div class="text-sm text-esprit-gray uppercase">Répartition</div>
          <div class="flex gap-4 items-end mt-3 h-16">
            {% for r,c in role_counts.items %}
              <div class="flex-1 text-center">
                <div class="bg-esprit-red/80 rounded-t" style="height: {{ c|default:0|add:1 }}0%"></div>
                <div class="text-xs mt-1 uppercase text-esprit-gray">{{ r }}</div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
        <div class="lg:col-span-2 p-6 bg-white rounded-2xl shadow border border-gray-200">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-lg font-semibold text-esprit-red">Gestion des utilisateurs</h2>
            <a class="text-esprit-red font-semibold" href="/dashboard/users">Ouvrir</a>
          </div>
          <p class="text-sm text-esprit-gray">Recherchez, filtrez et attribuez les rôles (Admin / Student) en temps réel.</p>
        </div>

        <div class="p-6 bg-white rounded-2xl shadow border border-gray-200">
          <h2 class="text-lg font-semibold text-esprit-red mb-2">Recommandations IA</h2>
          <p class="text-sm mb-3 text-esprit-gray">Panels suggérés selon les embeddings de profil.</p>
          <div class="flex flex-wrap gap-2">
            {% if recs %}
              {% for r in recs %}
                <span class="px-3 py-1 rounded-full bg-esprit-red/10 text-esprit-red">Panel {{ r.user_id|default:'User' }}</span>
              {% endfor %}
            {% else %}
              <span class="text-sm text-esprit-gray">Aucune recommandation pour le moment.</span>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="p-6 bg-white rounded-2xl shadow border border-gray-200">
        <h2 class="text-lg font-semibold text-esprit-red mb-2">Système</h2>
        <ul class="text-sm text-esprit-gray list-disc ml-5 space-y-1">
          <li>MongoDB opérationnel : <span class="font-semibold">{{ system.mongo_ok }}</span></li>
          <li>Build Tailwind : <code>/static/build/tailwind.css</code></li>
        </ul>
      </div>
    </div>
  {% endif %}
{% endblock %}
